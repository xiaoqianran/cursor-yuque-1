Directory structure:
â””â”€â”€ 2025_7_2-cursor/
    â”œâ”€â”€ requirements.txt
    â”œâ”€â”€ backend/
    â”‚   â””â”€â”€ app.py
    â””â”€â”€ frontend/
        â”œâ”€â”€ index.html
        â”œâ”€â”€ css/
        â”‚   â””â”€â”€ style.css
        â””â”€â”€ js/
            â””â”€â”€ app.js

================================================
FILE: requirements.txt
================================================
Flask
Flask-SQLAlchemy
SQLAlchemy



================================================
FILE: backend/app.py
================================================
# ========== å¯¼å…¥å¿…è¦çš„åº“ ==========
from flask import Flask, jsonify, request, send_from_directory
from flask_sqlalchemy import SQLAlchemy
from datetime import datetime
import os

# ========== åˆ›å»º Flask åº”ç”¨ ==========
app = Flask(__name__)

# ========== é…ç½®æ•°æ®åº“ ==========
# è·å–é¡¹ç›®æ ¹ç›®å½•
BASE_DIR = os.path.abspath(os.path.dirname(__file__))
# æ•°æ®åº“æ–‡ä»¶è·¯å¾„
DB_PATH = os.path.join(os.path.dirname(BASE_DIR), 'database', 'documents.db')
# ç¡®ä¿ database ç›®å½•å­˜åœ¨
os.makedirs(os.path.dirname(DB_PATH), exist_ok=True)

# é…ç½® SQLite æ•°æ®åº“
app.config['SQLALCHEMY_DATABASE_URI'] = f'sqlite:///{DB_PATH}'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
app.config['JSON_AS_ASCII'] = False  # æ”¯æŒä¸­æ–‡

# åˆå§‹åŒ–æ•°æ®åº“
db = SQLAlchemy(app)

print('=' * 50)
print('ğŸ“š æ–‡æ¡£ç³»ç»Ÿåç«¯å¯åŠ¨ä¸­...')
print(f'ğŸ“ æ•°æ®åº“è·¯å¾„: {DB_PATH}')
print('=' * 50)

# ========== å®šä¹‰æ•°æ®æ¨¡å‹ ==========
class Document(db.Model):
    """æ–‡æ¡£æ¨¡å‹"""
    __tablename__ = 'documents'
    
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False)
    content = db.Column(db.Text, default='')
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    def to_dict(self):
        """å°†å¯¹è±¡è½¬æ¢ä¸ºå­—å…¸"""
        return {
            'id': self.id,
            'title': self.title,
            'content': self.content,
            'createdAt': self.created_at.isoformat(),
            'updatedAt': self.updated_at.isoformat()
        }
    
    def __repr__(self):
        return f'<Document {self.id}: {self.title}>'

# ========== åˆ›å»ºæ•°æ®åº“è¡¨ ==========
with app.app_context():
    db.create_all()
    print('âœ… æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸï¼')

# ========== é™æ€æ–‡ä»¶è·¯ç”± ==========
@app.route('/')
def index():
    """è¿”å›å‰ç«¯é¡µé¢"""
    return send_from_directory('../frontend', 'index.html')

@app.route('/<path:path>')
def static_files(path):
    """è¿”å›é™æ€æ–‡ä»¶ï¼ˆCSSã€JSç­‰ï¼‰"""
    return send_from_directory('../frontend', path)

# ========== API è·¯ç”±ï¼šè·å–æ‰€æœ‰æ–‡æ¡£ ==========
@app.route('/api/documents', methods=['GET'])
def get_documents():
    """è·å–æ‰€æœ‰æ–‡æ¡£åˆ—è¡¨"""
    try:
        # æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£ï¼ŒæŒ‰æ›´æ–°æ—¶é—´å€’åºæ’åˆ—
        documents = Document.query.order_by(Document.updated_at.desc()).all()
        
        # è½¬æ¢ä¸ºå­—å…¸åˆ—è¡¨
        docs_list = [doc.to_dict() for doc in documents]
        
        print(f'ğŸ“‹ è·å–æ–‡æ¡£åˆ—è¡¨: {len(docs_list)} ä¸ªæ–‡æ¡£')
        
        return jsonify({
            'success': True,
            'data': docs_list,
            'total': len(docs_list)
        })
    except Exception as e:
        print(f'âŒ è·å–æ–‡æ¡£åˆ—è¡¨å¤±è´¥: {str(e)}')
        return jsonify({
            'success': False,
            'message': str(e)
        }), 500

# ========== API è·¯ç”±ï¼šè·å–å•ä¸ªæ–‡æ¡£ ==========
@app.route('/api/documents/<int:doc_id>', methods=['GET'])
def get_document(doc_id):
    """è·å–æŒ‡å®š ID çš„æ–‡æ¡£"""
    try:
        document = Document.query.get(doc_id)
        
        if not document:
            return jsonify({
                'success': False,
                'message': 'æ–‡æ¡£ä¸å­˜åœ¨'
            }), 404
        
        print(f'ğŸ“„ è·å–æ–‡æ¡£: {document.title}')
        
        return jsonify({
            'success': True,
            'data': document.to_dict()
        })
    except Exception as e:
        print(f'âŒ è·å–æ–‡æ¡£å¤±è´¥: {str(e)}')
        return jsonify({
            'success': False,
            'message': str(e)
        }), 500

# ========== API è·¯ç”±ï¼šåˆ›å»ºæ–‡æ¡£ ==========
@app.route('/api/documents', methods=['POST'])
def create_document():
    """åˆ›å»ºæ–°æ–‡æ¡£"""
    try:
        # è·å–è¯·æ±‚æ•°æ®
        data = request.get_json()
        
        # éªŒè¯å¿…å¡«å­—æ®µ
        if not data or not data.get('title'):
            return jsonify({
                'success': False,
                'message': 'æ ‡é¢˜ä¸èƒ½ä¸ºç©º'
            }), 400
        
        # åˆ›å»ºæ–°æ–‡æ¡£
        new_doc = Document(
            title=data['title'],
            content=data.get('content', f"# {data['title']}\n\nå¼€å§‹ç¼–å†™ä½ çš„å†…å®¹...")
        )
        
        # ä¿å­˜åˆ°æ•°æ®åº“
        db.session.add(new_doc)
        db.session.commit()
        
        print(f'âœ… åˆ›å»ºæ–‡æ¡£æˆåŠŸ: {new_doc.title}')
        
        return jsonify({
            'success': True,
            'data': new_doc.to_dict(),
            'message': 'æ–‡æ¡£åˆ›å»ºæˆåŠŸ'
        }), 201
    except Exception as e:
        db.session.rollback()
        print(f'âŒ åˆ›å»ºæ–‡æ¡£å¤±è´¥: {str(e)}')
        return jsonify({
            'success': False,
            'message': str(e)
        }), 500

# ========== API è·¯ç”±ï¼šæ›´æ–°æ–‡æ¡£ ==========
@app.route('/api/documents/<int:doc_id>', methods=['PUT'])
def update_document(doc_id):
    """æ›´æ–°æ–‡æ¡£å†…å®¹"""
    try:
        document = Document.query.get(doc_id)
        
        if not document:
            return jsonify({
                'success': False,
                'message': 'æ–‡æ¡£ä¸å­˜åœ¨'
            }), 404
        
        # è·å–è¯·æ±‚æ•°æ®
        data = request.get_json()
        
        # æ›´æ–°å­—æ®µ
        if 'title' in data:
            document.title = data['title']
        if 'content' in data:
            document.content = data['content']
        
        document.updated_at = datetime.utcnow()
        
        # ä¿å­˜åˆ°æ•°æ®åº“
        db.session.commit()
        
        print(f'âœ… æ›´æ–°æ–‡æ¡£æˆåŠŸ: {document.title}')
        
        return jsonify({
            'success': True,
            'data': document.to_dict(),
            'message': 'æ–‡æ¡£æ›´æ–°æˆåŠŸ'
        })
    except Exception as e:
        db.session.rollback()
        print(f'âŒ æ›´æ–°æ–‡æ¡£å¤±è´¥: {str(e)}')
        return jsonify({
            'success': False,
            'message': str(e)
        }), 500

# ========== API è·¯ç”±ï¼šåˆ é™¤æ–‡æ¡£ ==========
@app.route('/api/documents/<int:doc_id>', methods=['DELETE'])
def delete_document(doc_id):
    """åˆ é™¤æ–‡æ¡£"""
    try:
        document = Document.query.get(doc_id)
        
        if not document:
            return jsonify({
                'success': False,
                'message': 'æ–‡æ¡£ä¸å­˜åœ¨'
            }), 404
        
        doc_title = document.title
        
        # ä»æ•°æ®åº“åˆ é™¤
        db.session.delete(document)
        db.session.commit()
        
        print(f'âœ… åˆ é™¤æ–‡æ¡£æˆåŠŸ: {doc_title}')
        
        return jsonify({
            'success': True,
            'message': 'æ–‡æ¡£åˆ é™¤æˆåŠŸ'
        })
    except Exception as e:
        db.session.rollback()
        print(f'âŒ åˆ é™¤æ–‡æ¡£å¤±è´¥: {str(e)}')
        return jsonify({
            'success': False,
            'message': str(e)
        }), 500

# ========== å¯åŠ¨åº”ç”¨ ==========
if __name__ == '__main__':
    print('ğŸš€ æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼')
    print('ğŸ“ è®¿é—®åœ°å€: http://127.0.0.1:5000')
    print('=' * 50)
    app.run(debug=True, host='0.0.0.0', port=5000)



================================================
FILE: frontend/index.html
================================================
[Binary file]


================================================
FILE: frontend/css/style.css
================================================
/* ========== å…¨å±€æ ·å¼ ========== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
    background-color: #f5f5f5;
    color: hsl(0, 0%, 20%);
}

/* ========== å®¹å™¨å¸ƒå±€ ========== */
.container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

/* ========== é¡¶éƒ¨æ ‡é¢˜æ  ========== */
.header {
    background-color: #1890ff;
    color: white;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.header h1 {
    font-size: 24px;
    font-weight: 600;
}

.user-info {
    font-size: 14px;
}

/* ========== ä¸»å†…å®¹åŒºåŸŸ ========== */
.main-content {
    display: flex;
    flex: 1;
    overflow: hidden;
}

/* ========== å·¦ä¾§è¾¹æ æ ·å¼ ========== */
.sidebar {
    width: 280px;
    background-color: #fff;
    border-right: 1px solid #e8e8e8;
    display: flex;
    flex-direction: column;
}

.sidebar-header {
    padding: 20px;
    border-bottom: 1px solid #e8e8e8;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.sidebar-header h2 {
    font-size: 18px;
    font-weight: 600;
}

/* æ–°å»ºæŒ‰é’®æ ·å¼ */
.btn-new {
    background-color: #1890ff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s;
}

.btn-new:hover {
    background-color: #40a9ff;
}

/* æ–‡æ¡£åˆ—è¡¨å®¹å™¨ */
.doc-list {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
}

/* å•ä¸ªæ–‡æ¡£é¡¹ */
.doc-item {
    padding: 12px 16px;
    margin-bottom: 5px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
}

.doc-item:hover {
    background-color: #f0f0f0;
}

/* é€‰ä¸­çš„æ–‡æ¡£é¡¹ */
.doc-item.active {
    background-color: #e6f7ff;
    border-left: 3px solid #1890ff;
}

.doc-title {
    font-size: 14px;
    color: #333;
}

/* ========== å³ä¾§å†…å®¹åŒºåŸŸæ ·å¼ ========== */
.content-area {
    flex: 1;
    background-color: #fff;
    display: flex;
    flex-direction: column;
}

/* ========== å†…å®¹å¤´éƒ¨æ“ä½œæŒ‰é’® ========== */
.content-header {
    padding: 20px 30px;
    border-bottom: 1px solid #e8e8e8;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-actions {
    display: flex;
    gap: 10px;
}

.btn-save,
.btn-delete {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
}

.btn-save {
    background-color: #52c41a;
    color: white;
}

.btn-save:hover {
    background-color: #73d13d;
}

.btn-delete {
    background-color: #ff4d4f;
    color: white;
}

.btn-delete:hover {
    background-color: #ff7875;
}

/* ========== ç¼–è¾‘å™¨å®¹å™¨ ========== */
.editor-container {
    flex: 1;
    padding: 20px;
    overflow: hidden;
}

.editor-container .CodeMirror {
    height: 100% !important;
    font-size: 14px;
    line-height: 1.6;
}

/* ========== æ–‡æ¡£åˆ—è¡¨é¡¹å¢å¼º ========== */
.doc-item-content {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.doc-time {
    font-size: 12px;
    color: #999;
}

/* ========== é€šçŸ¥æ ·å¼ ========== */
.notification {
    position: fixed;
    top: 80px;
    right: -300px;
    background-color: #fff;
    color: #333;
    padding: 15px 25px;
    border-radius: 4px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: right 0.3s ease;
    z-index: 9999;
    font-size: 14px;
}

.notification.show {
    right: 30px;
}

/* ========== å†…å®¹åŒºåŸŸæ–‡æœ¬æ ·å¼ ========== */
.content-body h1 {
    font-size: 28px;
    margin-bottom: 20px;
    color: #1890ff;
}

.content-body h2 {
    font-size: 22px;
    margin-top: 30px;
    margin-bottom: 15px;
    color: #333;
}

.content-body p {
    margin-bottom: 15px;
    color: #666;
}

.content-body ul {
    margin-left: 20px;
    margin-bottom: 15px;
}

.content-body li {
    margin-bottom: 8px;
    color: #666;
}

/* ========== æ»šåŠ¨æ¡ç¾åŒ– ========== */
.doc-list::-webkit-scrollbar,
.content-body::-webkit-scrollbar {
    width: 6px;
}

.doc-list::-webkit-scrollbar-track,
.content-body::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.doc-list::-webkit-scrollbar-thumb,
.content-body::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 3px;
}

.doc-list::-webkit-scrollbar-thumb:hover,
.content-body::-webkit-scrollbar-thumb:hover {
    background: #999;
}



================================================
FILE: frontend/js/app.js
================================================
// ========== å…¨å±€å˜é‡ ==========
let documents = [];  // å­˜å‚¨æ‰€æœ‰æ–‡æ¡£
let currentDocId = null;  // å½“å‰é€‰ä¸­çš„æ–‡æ¡£ ID
let easyMDE = null;  // Markdown ç¼–è¾‘å™¨å®ä¾‹
let autoSaveTimer = null;  // è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨

// åç«¯ API åœ°å€
const API_BASE_URL = 'http://127.0.0.1:5000/api';

// ========== é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ ==========
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ“š æ–‡æ¡£ç³»ç»Ÿå¯åŠ¨...');
    
    // åˆå§‹åŒ– Markdown ç¼–è¾‘å™¨
    initMarkdownEditor();
    
    // ä»åç«¯åŠ è½½æ–‡æ¡£
    loadDocumentsFromServer();
    
    // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
    bindEvents();
    
    console.log('âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼');
});

// ========== åˆå§‹åŒ– Markdown ç¼–è¾‘å™¨ ==========
function initMarkdownEditor() {
    console.log('åˆå§‹åŒ– Markdown ç¼–è¾‘å™¨...');
    
    const textarea = document.getElementById('mdEditor');
    
    easyMDE = new EasyMDE({
        element: textarea,
        autofocus: false,
        spellChecker: false,
        placeholder: 'å¼€å§‹ç¼–å†™ä½ çš„æ–‡æ¡£...',
        toolbar: [
            'bold', 'italic', 'heading', '|',
            'quote', 'unordered-list', 'ordered-list', '|',
            'link', 'image', '|',
            'preview', 'side-by-side', 'fullscreen', '|',
            'guide'
        ],
        status: ['lines', 'words', 'cursor'],
        tabSize: 4,
    });
    
    // ç›‘å¬ç¼–è¾‘å™¨å†…å®¹å˜åŒ–
    easyMDE.codemirror.on('change', function() {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(function() {
            if (currentDocId) {
                autoSaveDocument();
            }
        }, 3000);
    });
}

// ========== ä»æœåŠ¡å™¨åŠ è½½æ–‡æ¡£ ==========
async function loadDocumentsFromServer() {
    console.log('ğŸ“¡ ä»æœåŠ¡å™¨åŠ è½½æ–‡æ¡£...');
    
    try {
        const response = await fetch(`${API_BASE_URL}/documents`);
        const result = await response.json();
        
        if (result.success) {
            documents = result.data;
            console.log(`âœ… åŠ è½½äº† ${documents.length} ä¸ªæ–‡æ¡£`);
            
            // æ¸²æŸ“æ–‡æ¡£åˆ—è¡¨
            renderDocList();
            
            // å¦‚æœæœ‰æ–‡æ¡£ï¼Œé€‰ä¸­ç¬¬ä¸€ä¸ª
            if (documents.length > 0) {
                selectDocument(documents[0].id);
            } else {
                // æ²¡æœ‰æ–‡æ¡£æ—¶åˆ›å»ºé»˜è®¤æ–‡æ¡£
                createDefaultDocument();
            }
        } else {
            console.error('âŒ åŠ è½½æ–‡æ¡£å¤±è´¥:', result.message);
            showNotification('âŒ åŠ è½½æ–‡æ¡£å¤±è´¥ï¼');
        }
    } catch (error) {
        console.error('âŒ ç½‘ç»œé”™è¯¯:', error);
        showNotification('âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼');
    }
}

// ========== åˆ›å»ºé»˜è®¤æ–‡æ¡£ ==========
async function createDefaultDocument() {
    console.log('åˆ›å»ºé»˜è®¤æ–‡æ¡£...');
    
    const defaultDoc = {
        title: 'æ¬¢è¿ä½¿ç”¨æ–‡æ¡£ç³»ç»Ÿ',
        content: `# æ¬¢è¿ä½¿ç”¨æˆ‘çš„æ–‡æ¡£ç³»ç»Ÿï¼ ğŸ“š

è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼**è¯­é›€**çš„æ–‡æ¡£ç®¡ç†ç³»ç»Ÿã€‚

## åŠŸèƒ½ç‰¹æ€§ âœ¨

- âœ… åˆ›å»ºå’Œç®¡ç†æ–‡æ¡£
- âœ… Markdown ç¼–è¾‘å™¨
- âœ… å®æ—¶é¢„è§ˆ
- âœ… è‡ªåŠ¨ä¿å­˜
- âœ… æ•°æ®åº“å­˜å‚¨

## å¼€å§‹ä½¿ç”¨ ğŸš€

1. ç‚¹å‡»å·¦ä¾§çš„ **+ æ–°å»º** æŒ‰é’®åˆ›å»ºæ–°æ–‡æ¡£
2. åœ¨ç¼–è¾‘å™¨ä¸­ç¼–å†™ Markdown å†…å®¹
3. ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜ä½ çš„ä¿®æ”¹
4. ç‚¹å‡» **ğŸ’¾ ä¿å­˜** æŒ‰é’®æ‰‹åŠ¨ä¿å­˜

## Markdown è¯­æ³•ç¤ºä¾‹

### ä»£ç å—
\`\`\`python
def hello():
    print("Hello, World!")
\`\`\`

### åˆ—è¡¨
- æ— åºåˆ—è¡¨é¡¹ 1
- æ— åºåˆ—è¡¨é¡¹ 2

### å¼•ç”¨
> è¿™æ˜¯ä¸€æ®µå¼•ç”¨æ–‡å­—

**å¼€å§‹åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£å§ï¼** ğŸ‰`
    };
    
    try {
        const response = await fetch(`${API_BASE_URL}/documents`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(defaultDoc)
        });
        
        const result = await response.json();
        
        if (result.success) {
            documents.push(result.data);
            renderDocList();
            selectDocument(result.data.id);
        }
    } catch (error) {
        console.error('âŒ åˆ›å»ºé»˜è®¤æ–‡æ¡£å¤±è´¥:', error);
    }
}

// ========== æ¸²æŸ“æ–‡æ¡£åˆ—è¡¨ ==========
function renderDocList() {
    console.log('æ¸²æŸ“æ–‡æ¡£åˆ—è¡¨...');
    
    const docListContainer = document.getElementById('docList');
    docListContainer.innerHTML = '';
    
    if (documents.length === 0) {
        docListContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">æš‚æ— æ–‡æ¡£</div>';
        return;
    }
    
    documents.forEach(doc => {
        const docItem = document.createElement('div');
        docItem.className = 'doc-item';
        
        if (doc.id === currentDocId) {
            docItem.classList.add('active');
        }
        
        docItem.dataset.docId = doc.id;
        
        docItem.innerHTML = `
            <div class="doc-item-content">
                <span class="doc-title">ğŸ“„ ${doc.title}</span>
                <span class="doc-time">${formatTime(doc.updatedAt)}</span>
            </div>
        `;
        
        docItem.addEventListener('click', function() {
            const docId = parseInt(this.dataset.docId);
            selectDocument(docId);
        });
        
        docListContainer.appendChild(docItem);
    });
}

// ========== æ ¼å¼åŒ–æ—¶é—´ ==========
function formatTime(timestamp) {
    const date = new Date(timestamp);
    const now = new Date();
    const diff = now - date;
    
    if (diff < 60000) return 'åˆšåˆš';
    if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
    if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
    if (diff < 604800000) return Math.floor(diff / 86400000) + 'å¤©å‰';
    
    return date.toLocaleDateString('zh-CN');
}

// ========== é€‰æ‹©æ–‡æ¡£ ==========
function selectDocument(docId) {
    console.log('é€‰æ‹©æ–‡æ¡£:', docId);
    
    if (currentDocId === docId) {
        return;
    }
    
    currentDocId = docId;
    renderDocList();
    showDocument(docId);
}

// ========== æ˜¾ç¤ºæ–‡æ¡£å†…å®¹ ==========
async function showDocument(docId) {
    console.log('ğŸ“¡ ä»æœåŠ¡å™¨è·å–æ–‡æ¡£:', docId);
    
    try {
        const response = await fetch(`${API_BASE_URL}/documents/${docId}`);
        const result = await response.json();
        
        if (result.success) {
            const doc = result.data;
            document.getElementById('currentDocTitle').textContent = doc.title;
            easyMDE.value(doc.content);
            console.log('âœ… æ–‡æ¡£åŠ è½½å®Œæˆ');
        } else {
            showNotification('âŒ åŠ è½½æ–‡æ¡£å¤±è´¥ï¼');
        }
    } catch (error) {
        console.error('âŒ ç½‘ç»œé”™è¯¯:', error);
        showNotification('âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼');
    }
}

// ========== ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ ==========
function bindEvents() {
    console.log('ç»‘å®šäº‹ä»¶ç›‘å¬å™¨...');
    
    document.getElementById('btnNewDoc').addEventListener('click', createNewDocument);
    document.getElementById('btnSave').addEventListener('click', saveCurrentDocument);
    document.getElementById('btnDelete').addEventListener('click', deleteCurrentDocument);
}

// ========== åˆ›å»ºæ–°æ–‡æ¡£ ==========
async function createNewDocument() {
    console.log('åˆ›å»ºæ–°æ–‡æ¡£...');
    
    const title = prompt('è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜ï¼š', 'æ–°æ–‡æ¡£');
    
    if (!title || title.trim() === '') {
        alert('âŒ æ–‡æ¡£æ ‡é¢˜ä¸èƒ½ä¸ºç©ºï¼');
        return;
    }
    
    const newDoc = {
        title: title.trim(),
        content: `# ${title.trim()}\n\nå¼€å§‹ç¼–å†™ä½ çš„å†…å®¹...`
    };
    
    try {
        const response = await fetch(`${API_BASE_URL}/documents`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(newDoc)
        });
        
        const result = await response.json();
        
        if (result.success) {
            documents.unshift(result.data);  // æ·»åŠ åˆ°åˆ—è¡¨å¼€å¤´
            renderDocList();
            selectDocument(result.data.id);
            showNotification('âœ… æ–‡æ¡£åˆ›å»ºæˆåŠŸï¼');
            console.log('âœ… æ–°æ–‡æ¡£åˆ›å»ºæˆåŠŸï¼', result.data);
        } else {
            showNotification('âŒ åˆ›å»ºå¤±è´¥ï¼š' + result.message);
        }
    } catch (error) {
        console.error('âŒ ç½‘ç»œé”™è¯¯:', error);
        showNotification('âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼');
    }
}

// ========== ä¿å­˜å½“å‰æ–‡æ¡£ ==========
async function saveCurrentDocument() {
    if (!currentDocId) {
        alert('âŒ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡æ¡£ï¼');
        return;
    }
    
    console.log('ğŸ’¾ ä¿å­˜æ–‡æ¡£:', currentDocId);
    
    const content = easyMDE.value();
    
    try {
        const response = await fetch(`${API_BASE_URL}/documents/${currentDocId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content })
        });
        
        const result = await response.json();
        
        if (result.success) {
            // æ›´æ–°æœ¬åœ°æ–‡æ¡£æ•°æ®
            const doc = documents.find(d => d.id === currentDocId);
            if (doc) {
                doc.content = content;
                doc.updatedAt = result.data.updatedAt;
            }
            renderDocList();
            showNotification('ğŸ’¾ æ–‡æ¡£å·²ä¿å­˜ï¼');
            console.log('âœ… æ–‡æ¡£ä¿å­˜æˆåŠŸï¼');
        } else {
            showNotification('âŒ ä¿å­˜å¤±è´¥ï¼š' + result.message);
        }
    } catch (error) {
        console.error('âŒ ç½‘ç»œé”™è¯¯:', error);
        showNotification('âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼');
    }
}

// ========== è‡ªåŠ¨ä¿å­˜æ–‡æ¡£ ==========
async function autoSaveDocument() {
    if (!currentDocId) return;
    
    console.log('ğŸ”„ è‡ªåŠ¨ä¿å­˜:', currentDocId);
    
    const content = easyMDE.value();
    
    try {
        const response = await fetch(`${API_BASE_URL}/documents/${currentDocId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content })
        });
        
        const result = await response.json();
        
        if (result.success) {
            const doc = documents.find(d => d.id === currentDocId);
            if (doc) {
                doc.updatedAt = result.data.updatedAt;
            }
            renderDocList();
            showNotification('ğŸ”„ å·²è‡ªåŠ¨ä¿å­˜', 1500);
        }
    } catch (error) {
        console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);
    }
}

// ========== åˆ é™¤å½“å‰æ–‡æ¡£ ==========
async function deleteCurrentDocument() {
    if (!currentDocId) {
        alert('âŒ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡æ¡£ï¼');
        return;
    }
    
    const doc = documents.find(d => d.id === currentDocId);
    
    if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡æ¡£"${doc.title}"å—ï¼Ÿ\næ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼`)) {
        return;
    }
    
    console.log('ğŸ—‘ï¸ åˆ é™¤æ–‡æ¡£:', currentDocId);
    
    try {
        const response = await fetch(`${API_BASE_URL}/documents/${currentDocId}`, {
            method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
            documents = documents.filter(d => d.id !== currentDocId);
            const deletedId = currentDocId;
            currentDocId = null;
            
            renderDocList();
            
            document.getElementById('currentDocTitle').textContent = 'é€‰æ‹©ä¸€ä¸ªæ–‡æ¡£å¼€å§‹ç¼–è¾‘';
            easyMDE.value('');
            
            if (documents.length > 0) {
                selectDocument(documents[0].id);
            }
            
            showNotification('ğŸ—‘ï¸ æ–‡æ¡£å·²åˆ é™¤ï¼');
            console.log('âœ… æ–‡æ¡£åˆ é™¤æˆåŠŸï¼');
        } else {
            showNotification('âŒ åˆ é™¤å¤±è´¥ï¼š' + result.message);
        }
    } catch (error) {
        console.error('âŒ ç½‘ç»œé”™è¯¯:', error);
        showNotification('âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼');
    }
}

// ========== æ˜¾ç¤ºé€šçŸ¥ ==========
function showNotification(message, duration = 2000) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.add('show');
    }, 10);
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, duration);
}


